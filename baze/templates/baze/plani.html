{% extends 'main.html' %}

{% block content %}

{% if ind_progresa_dati %}
<div style="margin-bottom: 40px;">
    <h2>Mans mēneša progress</h2>
    <p>Dienas līdz mēneša beigām: {{ palikusas_dienas }}</p>
    <table>
        <thead>
            <tr>
                <th>Kategorija</th>
                <th>Izpilde</th>
                <th>Plāns</th>
                <th>Progress (%)</th>
                <th>Dienas individuālais mērķis</th>
            </tr>
        </thead>
        <tbody>
            {% for row in ind_progresa_dati %}
            <tr>
                <td>{{ row.kategorija }}</td>
                <td>{{ row.izpilde }}</td>
                <td>{{ row.plans }}</td>
                <td>{{ row.progress }}%</td>
                <td>{{ row.dienas_merkis }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <table>
        <thead>
            <tr>
                <th>Kategorija</th>
                <th>Attiecība</th>
                <th>Procentuāli</th>
                <th>Plāns</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Atvērtā līguma proporcija</td>
                <td>{{ proporcijas.atv_iekartas|default:"0" }} / {{ proporcijas.iekartas|default:"0" }}</td>
                <td>{{ proporcijas.atv_proporcija|default:"0" }}%</td>
                <td>{{ proporcijas.atv_plans|default:"0" }}%</td>
            </tr>
            <tr>
                <td>Apdrošināšanas proporcija</td>
                <td>{{ proporcijas.apdr_iekartas|default:"0" }} / {{ proporcijas.iekartas|default:"0"|add:proporcijas.viedpaligi|default:"0" }}</td>
                <td>{{ proporcijas.apdr_proporcija|default:"0" }}%</td>
                <td>{{ proporcijas.apdr_plans|default:"0" }}%</td>
        </tbody>
    </table>
</div>
<hr>
{% endif %}

<div>
    {% if perms.baze.add_plans %}
    <a href="{% url 'add-plans' %}">Pievienot plānu</a>
    <div>
        {% for plans in plani %}
        <div>
            {% if perms.baze.change_plans %}
            <a href="{% url 'edit-plans' plans.id %}">Rediģēt</a>
            {% endif %}
            {% if perms.baze.delete_plans %}
            <a href="javascript:void(0);" 
                data-id="{{ plans.id }}"
                data-info="plānu: {{ plans.lietotajs.first_name }} - {{ plans.menesis }}/{{ plans.gads }}"
                data-url="{% url 'delete-plans' plans.id %}"
                onclick="openDeleteModal(this)">
                Dzēst
            </a>

            <div id="deleteModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4);">
                <div style="background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888; border-radius: 5px; width: 80%; max-width: 500px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="margin: 0;">Dzēst darījumu</h2>
                        <span onclick="closeDeleteModal()" style="color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
                    </div>
                    <p id="deleteMessage" style="margin-bottom: 20px;"></p>
                    <div style="display: flex; justify-content: flex-end; gap: 10px;">
                        <button onclick="closeDeleteModal()" style="padding: 10px 20px; background-color: #6c757d; color: white; border: none; border-radius: 3px; cursor: pointer;">Atcelt</button>
                        <form id="deleteForm" method="POST" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" style="padding: 10px 20px; background-color: #dc3545; color: white; border: none; border-radius: 3px; cursor: pointer;">Dzēst</button>
                        </form>
                    </div>
                </div>
            </div>
            {% endif %}
            <span>{{plans}}</span>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>

<hr>

{% for chart in grafiki %}
    <div class="chart-container" style="margin-bottom: 40px;">
        {{ chart|safe }}
    </div>
{% empty %}
    <p>Nav pieejamu plānu vai darījumu datu.</p>
{% endfor %}


{% endblock %}