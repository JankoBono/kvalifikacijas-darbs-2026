{% extends 'main.html' %}

{% block content %}

{% for darijums in darijumi %}
<div>
    <div>
        <span>{{ darijums.datums|date:"d.m.Y H:i" }}</span>
    </div>
    
    <div>
        {% if darijums.pieslegums %}
            <span>Pieslēgums: {{ darijums.pieslegums }}</span>
        {% endif %}
        
        {% if darijums.atv_iekarta %}
            <span>Atvērtā iekārta: {{ darijums.atv_iekarta }}</span>
        {% endif %}
        
        {% if darijums.nom_iekarta %}
            <span>Nomaksas iekārta: {{ darijums.nom_iekarta }}</span>
        {% endif %}
        
        {% if darijums.pil_iekarta %}
            <span>Pilnas cenas iekārta: {{ darijums.pil_iekarta }}</span>
        {% endif %}
        
        {% if darijums.viedpaligs %}
            <span>Viedpalīgs: {{ darijums.viedpaligs }}</span>
        {% endif %}

        {% if darijums.apdr_iekartas %}
            <span>Apdrošināta iekārta: {{ darijums.apdr_iekartas }}</span>
        {% endif %}
        
        {% if darijums.aksesuars %}
            <span>Aksesuārs: {{ darijums.aksesuars }}</span>
        {% endif %}
        
        {% if darijums.viedtelevizija %}
            <span>Viedtelevīzija: {{ darijums.viedtelevizija }}</span>
        {% endif %}
        
    </div>
    <a href="{% url 'edit-darijums' darijums.id %}">Rediģēt</a>
    <a href="javascript:void(0);" onclick="openDeleteModal('{{ darijums.id }}', '{{ darijums }}')">Dzēst</a>

<div id="deleteModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4);">
    <div style="background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888; border-radius: 5px; width: 80%; max-width: 500px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="margin: 0;">Dzēst darījumu</h2>
            <span onclick="closeDeleteModal()" style="color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
        </div>
        <p id="deleteMessage" style="margin-bottom: 20px;"></p>
        <div style="display: flex; justify-content: flex-end; gap: 10px;">
            <button onclick="closeDeleteModal()" style="padding: 10px 20px; background-color: #6c757d; color: white; border: none; border-radius: 3px; cursor: pointer;">Atcelt</button>
            <form id="deleteForm" method="POST" style="display: inline;">
                {% csrf_token %}
                <button type="submit" style="padding: 10px 20px; background-color: #dc3545; color: white; border: none; border-radius: 3px; cursor: pointer;">Dzēst</button>
            </form>
        </div>
    </div>
</div>

</div>
{% endfor %}

<script>
function openDeleteModal(darijumsId, darijumsInfo) {
    document.getElementById('deleteModal').style.display = 'block';
    document.getElementById('deleteMessage').textContent = 'Vai tiešām vēlaties izdzēst darījumu: ' + darijumsInfo + '?';
    document.getElementById('deleteForm').action = "{% url 'delete-darijums' 0 %}".replace('0', darijumsId);
}

function closeDeleteModal() {
    document.getElementById('deleteModal').style.display = 'none';
}

// Close modal when clicking outside of it
window.onclick = function(event) {
    var modal = document.getElementById('deleteModal');
    if (event.target == modal) {
        closeDeleteModal();
    }
}
</script>

{% endblock %}